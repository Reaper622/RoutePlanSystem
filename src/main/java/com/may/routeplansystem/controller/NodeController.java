package com.may.routeplansystem.controller;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import com.may.routeplansystem.pojo.NodePojo;import com.may.routeplansystem.service.NodeService;import com.may.routeplansystem.util.ExcelUtil;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.*;import org.springframework.web.multipart.MultipartFile;import org.thymeleaf.util.StringUtils;import javax.servlet.http.HttpSession;import java.util.HashMap;import java.util.Map;import static org.springframework.web.bind.annotation.RequestMethod.POST;/** * @author:dengsiyuan * @Date:2018/10/22 16:30 */@RestController@RequestMapping("node")public class NodeController {    private String userAttribute = "user";    @Autowired    private NodeService nodeService;    /**     * @api {POST} /node/newNode 服务点的录入     * @apiDescription 用户服务点的录入（通过点地图）     * @apiGroup node     * @apiParamExample {json} Request-Example:     *     {     *         "nodeId":1,{int}服务点编号     *         "questionId":1,{int}问题编号     *         "nodeName":"邮电大学服务点",{String}服务点名称     *         "nodeAddress":"重庆市南岸区南山街道崇文路2号重庆邮电大学",{String}服务点地址     *         "lat":155.52,{float}纬度     *         "len":242.25,{float}经度     *         "isCenter":1/0{int}1代表标记为中心点     *         "delFlag":1{int}是否已标记删除，1代表删除     *     }     * @apiSuccessExample Success-Response:     *     HTTP/1.1 200 OK     *     {     *         "status":1     *     }     * @apiError 0 该功能存在异常     * @apiError 2 导入失败，请重试     * @apiError 4 请完善必要的信息     * @apiError 5 您未登录，请登陆后操作     * @apiErrorExample {json} Error-Response:     *     HTTP/1.1 0 存在异常     *     {     *        "status": "0"     *     }     */    @RequestMapping(value = "newNode",method = RequestMethod.POST)    public void insertNode(@RequestBody JSONObject nodeJson, HttpSession session){        NodePojo nodePojo = JSONObject.toJavaObject(nodeJson,NodePojo.class);        Map map = new HashMap<String,String>(16);        try {            if(session.getAttribute(userAttribute) != null){                if(nodeJson != null){                }else {                }            }else {            }        }catch (Exception e){            e.printStackTrace();        }    }    /**     * @api {POST} /node/excelNodeInfo 服务点的录入     * @apiDescription 用户服务点的录入（通过Excel）     * @apiGroup node     * @apiParamExample {MultipartFile}     * @apiSuccessExample Success-Response:     *     HTTP/1.1 200 OK     *     {     *         "status":"导入成功"     *     }     * @apiErrorExample {json} Error-Response:     *     HTTP/1.1 0 存在异常     *     {     *        "status": "第1行...数据出现问题"     *     }     */    @RequestMapping(value = "/excelNodeInfo",method = POST)    public Object upload(@RequestParam(value="file", required = false) MultipartFile file, HttpSession session) throws Exception {        Map map = new HashMap<String,String>(16);        try {            //判断文件是否为空            if (file == null) {                map.clear();                //4,文件为空                map.put("status","您所上传文件为空！！");            }            //获取文件名            String fileName = file.getOriginalFilename();            //验证文件名是否合格            if (!ExcelUtil.validateExcel(fileName)) {                map.clear();                //3，文件不符合要求                map.put("status","文件类型不符合要求");            }            //获取到文件名后，再次判断是否符合要求，是否为空            long size = file.getSize();            if (StringUtils.isEmpty(fileName) || size == 0) {                //4,文件大小或名称为空                map.put("status","文件大小或名称为空!!");            }            //批量导入            String message = nodeService.batchImport(fileName,file,session);            map.clear();            map.put("status",message);        }catch (Exception e){            map.clear();            map.put("status","上传失败！！！");            e.printStackTrace();        }        return JSON.toJSON(map);    }}